<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>分类推荐管理 | 阳光优采</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- FontAwesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- 自定义样式 -->
  <link rel="stylesheet" href="../../assets/custom.css">
  
  <style>
    @layer utilities {
      .text-primary { color: #E2231A; }
      .bg-primary { background-color: #E2231A; }
      .border-primary { border-color: #E2231A; }
    }
    
    .tab-btn.active {
      color: #E2231A;
      border-bottom: 2px solid #E2231A;
      font-weight: 600;
    }
    
    .drawer-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 50;
    }
    
    .drawer-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .drawer-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 420px;
      height: 100%;
      background: white;
      transform: translateX(100%);
      transition: transform 0.2s ease;
      z-index: 60;
      overflow-y: auto;
      box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
    }
    
    .drawer-panel.active {
      transform: translateX(0);
    }
    
    .form-label {
      font-size: 13px;
      color: #374151;
      font-weight: 500;
    }
    
    .status-tag {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 9999px;
      font-weight: 600;
    }
    
    .tag-enabled {
      background: #dcfce7;
      color: #16a34a;
    }
    
    .tag-disabled {
      background: #fee2e2;
      color: #dc2626;
    }
    
    .filter-select {
      min-width: 180px;
    }
    
    .filter-input {
      min-width: 220px;
    }
    
    .readonly-field {
      background: #f8fafc;
      color: #4b5563;
    }
    
    /* 下拉框选项置灰样式 */
    select option:disabled {
      color: #9ca3af;
      font-style: italic;
    }
    
    /* 复用推荐弹窗样式 */
    .reuse-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      backdrop-filter: blur(2px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 100;
    }
    
    .reuse-modal-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .reuse-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.96);
      width: 90%;
      max-width: 720px;
      max-height: 85vh;
      background: white;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);
      opacity: 0;
      pointer-events: none;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 101;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .reuse-modal.active {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }
    
    .reuse-modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #f3f4f6;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      background: linear-gradient(to bottom, #ffffff, #fafafa);
    }
    
    .reuse-modal-header h3 {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
      margin: 0;
      line-height: 1.4;
    }
    
    .reuse-modal-header p {
      font-size: 13px;
      color: #6b7280;
      margin: 4px 0 0 0;
      line-height: 1.5;
    }
    
    .reuse-modal-header button {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    
    .reuse-modal-header button:hover {
      background: #f3f4f6;
      color: #374151;
    }
    
    .reuse-modal-body {
      padding: 20px 24px;
      overflow-y: auto;
      flex: 1;
      background: #ffffff;
      min-height: 0;
    }
    
    #reuseStationList {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .reuse-modal-tip {
      padding: 12px 16px;
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border-top: 1px solid #bfdbfe;
      flex-shrink: 0;
    }
    
    .reuse-modal-tip p {
      margin: 0;
      line-height: 1.6;
      font-size: 13px;
      color: #1e40af;
      font-weight: 500;
    }
    
    .reuse-modal-tip i {
      color: #3b82f6;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .reuse-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #f3f4f6;
      background: #fafbfc;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-shrink: 0;
    }
    
    .station-card {
      padding: 18px 20px;
      border: 1.5px solid #e5e7eb;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      margin-bottom: 0;
      background: #ffffff;
      position: relative;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .station-card:not(:last-child) {
      margin-bottom: 12px;
    }
    
    .station-card:hover {
      border-color: #E2231A;
      background: linear-gradient(to right, #fef2f2, #ffffff);
      box-shadow: 0 2px 8px rgba(226, 35, 26, 0.08);
      transform: translateY(-1px);
    }
    
    .station-card.selected {
      border-color: #E2231A;
      background: linear-gradient(to right, #fef2f2, #ffffff);
      box-shadow: 0 4px 12px rgba(226, 35, 26, 0.12), 0 0 0 3px rgba(226, 35, 26, 0.08);
    }
    
    .station-card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    
    .station-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .station-card-title {
      font-size: 15px;
      font-weight: 600;
      color: #111827;
      letter-spacing: 0.01em;
    }
    
    .station-card-checkbox {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .station-card-checkbox i {
      font-size: 20px;
      transition: all 0.2s;
    }
    
    .station-card.selected .station-card-checkbox i {
      transform: scale(1.1);
    }
    
    .station-card-stats {
      display: flex;
      gap: 28px;
      font-size: 13px;
      flex-wrap: wrap;
    }
    
    .station-card-stat {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: #f9fafb;
      border-radius: 6px;
      border: 1px solid #f3f4f6;
    }
    
    .station-card.selected .station-card-stat {
      background: #ffffff;
      border-color: #fee2e2;
    }
    
    .station-card-stat i {
      flex-shrink: 0;
      width: 14px;
      text-align: center;
    }
    
    .station-card-stat-label {
      color: #6b7280;
      font-size: 12px;
      white-space: nowrap;
    }
    
    .station-card-stat-value {
      font-weight: 700;
      color: #111827;
      font-size: 14px;
      min-width: 20px;
      text-align: right;
      margin-left: 2px;
    }
    
    
    /* 按钮样式优化 */
    .reuse-modal-footer button {
      padding: 10px 24px;
      font-size: 14px;
      font-weight: 500;
      border-radius: 8px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 100px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .reuse-modal-footer button:last-child {
      border: 1.5px solid #d1d5db;
      background: white;
      color: #374151;
    }
    
    .reuse-modal-footer button:last-child:hover {
      background: #f9fafb;
      border-color: #9ca3af;
      color: #111827;
    }
    
    .reuse-modal-footer button:first-child:not(:disabled) {
      background: #E2231A;
      color: white;
      border: none;
      box-shadow: 0 2px 6px rgba(226, 35, 26, 0.25);
    }
    
    .reuse-modal-footer button:first-child:not(:disabled):hover {
      background: #c01e16;
      box-shadow: 0 4px 12px rgba(226, 35, 26, 0.35);
      transform: translateY(-1px);
    }
    
    .reuse-modal-footer button:first-child:not(:disabled):active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(226, 35, 26, 0.25);
    }
    
    .reuse-modal-footer button:first-child:disabled {
      background: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
      box-shadow: none;
      border: none;
    }
    
    /* 供应商分站显示样式（暗红色底，白色字） */
    .station-text-supplier {
      background: #991b1b;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      min-width: 120px;
      text-align: center;
    }
    
    /* 角色选择器样式 */
    .role-selector-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .role-selector {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      background: white;
      font-size: 14px;
      cursor: pointer;
      min-width: 140px;
    }
    
    /* 左侧导航栏样式 */
    .admin-sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 240px;
      height: 100vh;
      background: #1e293b;
      color: white;
      transition: width 0.3s ease;
      z-index: 100;
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    .admin-sidebar.collapsed {
      width: 64px;
    }
    
    .admin-sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .admin-sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      font-size: 16px;
      white-space: nowrap;
      opacity: 1;
      transition: opacity 0.3s;
    }
    
    .admin-sidebar.collapsed .admin-sidebar-logo span {
      opacity: 0;
      width: 0;
      overflow: hidden;
    }
    
    .admin-sidebar-toggle {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    
    .admin-sidebar-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .admin-menu {
      padding: 10px 0;
    }
    
    .admin-menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      white-space: nowrap;
    }
    
    .admin-menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .admin-menu-item.active {
      background: rgba(226, 35, 26, 0.2);
      color: white;
      border-left: 3px solid #E2231A;
    }
    
    .admin-menu-item i {
      width: 20px;
      text-align: center;
      flex-shrink: 0;
    }
    
    .admin-menu-item span {
      opacity: 1;
      transition: opacity 0.3s;
    }
    
    .admin-sidebar.collapsed .admin-menu-item span {
      opacity: 0;
      width: 0;
      overflow: hidden;
    }
    
    /* 内容区域 */
    .admin-content {
      margin-left: 240px;
      transition: margin-left 0.3s ease;
      min-height: 100vh;
    }
    
    .admin-sidebar.collapsed ~ .admin-content {
      margin-left: 64px;
    }
  </style>
</head>
<body class="bg-gray-50">
  
  <!-- 左侧导航栏 -->
  <div class="admin-sidebar" id="adminSidebar">
    <div class="admin-sidebar-header">
      <div class="admin-sidebar-logo">
        <i class="fas fa-cog"></i>
        <span>管理后台</span>
      </div>
      <button class="admin-sidebar-toggle" onclick="toggleAdminSidebar()" title="收起/展开">
        <i class="fas fa-chevron-left" id="sidebarToggleIcon"></i>
      </button>
    </div>
    <nav class="admin-menu">
      <a href="admin_dashboard.html" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_dashboard.html')">
        <i class="fas fa-home"></i>
        <span>首页</span>
      </a>
      <a href="#" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_users.html')">
        <i class="fas fa-users"></i>
        <span>用户信息管理</span>
      </a>
      <a href="#" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_verify.html')">
        <i class="fas fa-building"></i>
        <span>用户企业信息认证</span>
      </a>
      <a href="#" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_verify.html')">
        <i class="fas fa-store"></i>
        <span>供应商认证</span>
      </a>
      <a href="#" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_po.html')">
        <i class="fas fa-file-invoice"></i>
        <span>采购单管理</span>
      </a>
      <a href="#" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_orders.html')">
        <i class="fas fa-shopping-bag"></i>
        <span>订单信息</span>
      </a>
      <a href="#" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_notice.html')">
        <i class="fas fa-bullhorn"></i>
        <span>公告管理</span>
      </a>
      <a href="admin_reco_manage.html" class="admin-menu-item active" onclick="handleMenuClick(this, 'admin_reco_manage.html')">
        <i class="fas fa-layer-group"></i>
        <span>分类推荐管理</span>
      </a>
      <a href="#" class="admin-menu-item" onclick="handleMenuClick(this, 'admin_station.html')">
        <i class="fas fa-sitemap"></i>
        <span>分站管理</span>
      </a>
    </nav>
  </div>
  
  <!-- 主容器 -->
  <div class="admin-content">
    <div class="min-h-screen p-6 max-w-[1920px] mx-auto">
    
    <!-- 页面头部 -->
    <div class="mb-6">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm text-gray-500 mb-1">管理后台 / 内容运营</div>
          <h1 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
            <i class="fas fa-layer-group text-primary"></i>
            分类推荐管理
          </h1>
          <p class="text-sm text-gray-600 mt-1">统一管理首页推荐分类与推荐产品内容</p>
        </div>
        <div class="flex items-center gap-4">
          <!-- 角色选择器 -->
          <div class="role-selector-wrapper">
            <label class="text-sm text-gray-600 whitespace-nowrap">当前角色：</label>
            <select id="roleSelector" class="role-selector" onchange="switchRole()">
              <option value="admin">平台管理员</option>
              <option value="supplier">供应商</option>
            </select>
          </div>
          <span id="roleTag" class="px-3 py-1 text-xs rounded-full bg-red-50 text-red-600 border border-red-100">
            平台管理员
          </span>
          <span id="roleHint" class="text-xs text-gray-500">仅管理员可配置推荐</span>
        </div>
      </div>
    </div>
    
    <!-- Tabs -->
    <div class="bg-white rounded-lg shadow-sm mb-4">
      <div class="flex items-center gap-6 px-5 pt-4 border-b">
        <!-- 分站显示区域 -->
        <div class="flex items-center gap-2 pr-4 border-r border-gray-200" id="stationDisplayArea">
          <div id="stationDisplay" class="flex items-center">
            <!-- 供应商：只读文本（暗红色底，白色字） -->
            <span id="stationText" class="station-text-supplier hidden"></span>
            <!-- 管理员：下拉框（样式与tab按钮一致） -->
            <select id="stationSelect" class="tab-btn pb-3 text-gray-600 border-0 bg-transparent cursor-pointer focus:outline-none hidden" onchange="handleStationChange()" style="appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'12\' height=\'12\' viewBox=\'0 0 12 12\'%3E%3Cpath fill=\'%23666\' d=\'M6 9L1 4h10z\'/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right center; padding-right: 24px;">
              <option value="main" selected>总站</option>
              <option value="beijing">北京分站</option>
              <option value="shanghai">上海分站</option>
              <option value="guangzhou">广州分站</option>
              <option value="shenzhen">深圳分站</option>
            </select>
          </div>
        </div>
        <!-- Tab 按钮 -->
        <button class="tab-btn pb-3 active" data-tab="lv1" onclick="switchTab('lv1')">
          一级推荐分类 <span class="text-xs text-gray-400" id="countLv1">0</span>
        </button>
        <button class="tab-btn pb-3 text-gray-600" data-tab="lv2" onclick="switchTab('lv2')">
          二级推荐分类 <span class="text-xs text-gray-400" id="countLv2">0</span>
        </button>
        <button class="tab-btn pb-3 text-gray-600" data-tab="product" onclick="switchTab('product')">
          推荐产品 <span class="text-xs text-gray-400" id="countProduct">0</span>
        </button>
      </div>
      
      <!-- 筛选与操作 -->
      <div class="p-5">
        <div id="filterBar" class="flex flex-wrap items-center gap-3">
          <!-- 动态渲染筛选项 -->
        </div>
        <div class="flex items-center justify-between mt-4">
          <div class="text-xs text-gray-500">已选 <span id="selectedCount">0</span> 项</div>
          <div class="flex items-center gap-2">
            <button id="reuseRecommendBtn" onclick="openReuseModal()" class="px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded border border-blue-100 hover:bg-blue-100 hidden">
              <i class="fas fa-copy"></i> 复用推荐
            </button>
            <button onclick="batchAction('enable')" class="px-3 py-2 text-sm bg-green-50 text-green-700 rounded border border-green-100 hover:bg-green-100">
              <i class="fas fa-check-circle"></i> 批量启用
            </button>
            <button onclick="batchAction('disable')" class="px-3 py-2 text-sm bg-yellow-50 text-yellow-700 rounded border border-yellow-100 hover:bg-yellow-100">
              <i class="fas fa-ban"></i> 批量禁用
            </button>
            <button onclick="batchAction('delete')" class="px-3 py-2 text-sm bg-red-50 text-red-700 rounded border border-red-100 hover:bg-red-100">
              <i class="fas fa-trash-alt"></i> 批量删除
            </button>
            <button onclick="openDrawer('create')" class="px-4 py-2 text-sm btn-primary text-white rounded">
              <i class="fas fa-plus"></i> 新建
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 列表区 -->
    <div class="bg-white rounded-lg shadow-sm">
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50 text-gray-600">
            <tr id="tableHead"></tr>
          </thead>
          <tbody id="tableBody" class="divide-y"></tbody>
        </table>
      </div>
      <div class="p-4 text-xs text-gray-500 flex items-center justify-between">
        <div>共 <span id="totalCount">0</span> 条记录</div>
        <div class="flex items-center gap-2">
          <button class="px-2 py-1 border rounded text-gray-500">上一页</button>
          <span>1 / 1</span>
          <button class="px-2 py-1 border rounded text-gray-500">下一页</button>
        </div>
      </div>
    </div>
    </div>
  </div>
  
  <!-- 抽屉 -->
  <div id="drawerOverlay" class="drawer-overlay" onclick="closeDrawer()"></div>
  <div id="drawerPanel" class="drawer-panel">
    <div class="p-5 border-b flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div>
          <div class="flex items-center gap-2">
            <div id="drawerTitle" class="text-lg font-semibold text-gray-900">新建配置</div>
            <span id="drawerStation" class="text-primary font-semibold text-base"></span>
          </div>
          <div id="drawerSubtitle" class="text-xs text-gray-500 mt-1">请完善必填信息</div>
        </div>
      </div>
      <button class="text-gray-400 hover:text-gray-600" onclick="closeDrawer()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-5 space-y-4">
      
      <!-- 一级分类表单 -->
      <div id="formLv1" class="space-y-4">
        <div>
          <label class="form-label">一级推荐分类名称</label>
          <select id="lv1Name" class="mt-1 w-full px-3 py-2 border rounded text-sm" onchange="handleLv1NameChange()">
            <option value="">请选择一级分类</option>
          </select>
        </div>
        <div>
          <label class="form-label">推荐位序号</label>
          <input id="lv1OrderNo" type="number" class="mt-1 w-full px-3 py-2 border rounded text-sm" placeholder="如：1">
        </div>
        <div>
          <label class="form-label">示意图 URL</label>
          <input id="lv1Image" type="text" class="mt-1 w-full px-3 py-2 border rounded text-sm" placeholder="https://">
          <div class="mt-2 h-24 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-400">示意图预览</div>
        </div>
        <div>
          <label class="form-label">状态</label>
          <select id="lv1Status" class="mt-1 w-full px-3 py-2 border rounded text-sm">
            <option value="enabled">启用</option>
            <option value="disabled">禁用</option>
          </select>
        </div>
      </div>
      
      <!-- 二级分类表单 -->
      <div id="formLv2" class="space-y-4 hidden">
        <div>
          <label class="form-label">所属一级分类</label>
          <select id="lv2Parent" class="mt-1 w-full px-3 py-2 border rounded text-sm" onchange="handleLv2ParentChange()">
            <option>办公用品</option>
            <option>劳保防护</option>
            <option>数码设备</option>
            <option>清洁保养</option>
            <option>办公家具</option>
            <option>行政耗材</option>
            <option>电子设备</option>
            <option>安全防护</option>
            <option>办公耗材</option>
            <option>仓储物流</option>
          </select>
        </div>
        <div>
          <label class="form-label">二级分类名称</label>
          <select id="lv2Name" class="mt-1 w-full px-3 py-2 border rounded text-sm" onchange="handleLv2NameChange()">
            <option value="">请选择二级分类</option>
          </select>
        </div>
        <div>
          <label class="form-label">推荐位序号</label>
          <input id="lv2OrderNo" type="number" class="mt-1 w-full px-3 py-2 border rounded text-sm" placeholder="如：1">
        </div>
        <div>
          <label class="form-label">状态</label>
          <select id="lv2Status" class="mt-1 w-full px-3 py-2 border rounded text-sm">
            <option value="enabled">启用</option>
            <option value="disabled">禁用</option>
          </select>
        </div>
      </div>
      
      <!-- 推荐产品表单 -->
      <div id="formProduct" class="space-y-4 hidden">
        <div>
          <label class="form-label">所属一级分类</label>
          <select id="productLv1" class="mt-1 w-full px-3 py-2 border rounded text-sm">
            <option>办公用品</option>
            <option>劳保防护</option>
            <option>数码设备</option>
            <option>清洁保养</option>
          </select>
        </div>
        <div>
          <label class="form-label">所属二级分类</label>
          <select id="productLv2" class="mt-1 w-full px-3 py-2 border rounded text-sm">
            <option>A4 复印纸</option>
            <option>打印耗材</option>
            <option>劳保手套</option>
            <option>消毒用品</option>
          </select>
        </div>
        <div>
          <label class="form-label">推荐产品（可搜索）</label>
          <input id="productSearch" type="text" class="mt-1 w-full px-3 py-2 border rounded text-sm" placeholder="输入关键词筛选产品">
          <select id="productSelect" class="mt-2 w-full px-3 py-2 border rounded text-sm" onchange="handleProductSelect()">
            <option value="">请选择产品</option>
          </select>
        </div>
        <div>
          <label class="form-label">推荐位序号</label>
          <input id="productOrderNo" type="number" class="mt-1 w-full px-3 py-2 border rounded text-sm" placeholder="如：1">
        </div>
        <div>
          <label class="form-label">图片 URL（回填）</label>
          <input id="productImage" type="text" class="mt-1 w-full px-3 py-2 border rounded text-sm readonly-field" readonly>
          <div id="productImagePreview" class="mt-2 h-24 bg-gray-100 rounded flex items-center justify-center text-xs text-gray-400">图片预览</div>
        </div>
        <div>
          <label class="form-label">价格（元）（回填）</label>
          <input id="productPrice" type="number" class="mt-1 w-full px-3 py-2 border rounded text-sm readonly-field" readonly>
        </div>
        <div>
          <label class="form-label">价格推荐值（单值）（回填）</label>
          <input id="productRecommendPrice" type="number" class="mt-1 w-full px-3 py-2 border rounded text-sm readonly-field" readonly>
        </div>
        <div>
          <label class="form-label">产品介绍（回填）</label>
          <textarea id="productIntro" rows="3" class="mt-1 w-full px-3 py-2 border rounded text-sm readonly-field" readonly></textarea>
        </div>
        <div>
          <label class="form-label">状态</label>
          <select id="productStatus" class="mt-1 w-full px-3 py-2 border rounded text-sm">
            <option value="enabled">启用</option>
            <option value="disabled">禁用</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="p-5 border-t bg-gray-50 flex items-center justify-end gap-2">
      <button onclick="closeDrawer()" class="px-4 py-2 text-sm border rounded">取消</button>
      <button onclick="saveDrawer()" class="px-4 py-2 text-sm btn-primary text-white rounded">
        <i class="fas fa-save"></i> 保存
      </button>
    </div>
  </div>
  
  <!-- 复用推荐弹窗 -->
  <div id="reuseModalOverlay" class="reuse-modal-overlay" onclick="closeReuseModal()"></div>
  <div id="reuseModal" class="reuse-modal">
    <div class="reuse-modal-header">
      <div>
        <h3 class="text-lg font-semibold text-gray-900">复用推荐</h3>
        <p class="text-sm text-gray-500 mt-1">选择要复用的分站推荐配置</p>
      </div>
      <button class="text-gray-400 hover:text-gray-600" onclick="closeReuseModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="reuse-modal-body">
      <div id="reuseStationList">
        <!-- 动态渲染分站卡片 -->
      </div>
    </div>
    <div class="reuse-modal-tip">
      <p class="text-sm flex items-center gap-2">
        <i class="fas fa-info-circle"></i>
        复用其他分站推荐分类后，仍将保留本站原有推荐配置。
      </p>
    </div>
    <div class="reuse-modal-footer">
      <button id="confirmReuseBtn" onclick="confirmReuse()" class="px-4 py-2 text-sm btn-primary text-white rounded disabled:opacity-50 disabled:cursor-not-allowed" disabled>
        <i class="fas fa-check"></i> 确认复用
      </button>
      <button onclick="closeReuseModal()">
        取消
      </button>
    </div>
  </div>
  
  <script>
    const roleNameMap = {
      admin: '平台管理员',
      buyer: '采购专员',
      'buyer-user': '普通采购用户',
      supplier: '供应商',
      guest: '访客'
    };
    
    // 分站数据
    const stationList = [
      { id: 'main', name: '总站' },
      { id: 'beijing', name: '北京分站' },
      { id: 'shanghai', name: '上海分站' },
      { id: 'guangzhou', name: '广州分站' },
      { id: 'shenzhen', name: '深圳分站' }
    ];
    
    // 各分站的推荐配置统计（mock数据）
    const stationStats = {
      'main': { lv1: 8, lv2: 15, product: 20 },
      'beijing': { lv1: 6, lv2: 10, product: 12 },
      'shanghai': { lv1: 5, lv2: 8, product: 9 },
      'guangzhou': { lv1: 4, lv2: 7, product: 8 },
      'shenzhen': { lv1: 3, lv2: 5, product: 6 }
    };
    
    let selectedReuseStation = null; // 选中的复用分站
    
    // 一级分类完整数据源（从其他系统维护）
    const allLv1Categories = [
      '办公用品',
      '劳保防护',
      '数码设备',
      '清洁保养',
      '办公家具',
      '行政耗材',
      '电子设备',
      '安全防护',
      '办公耗材',
      '仓储物流'
    ];
    
    // 二级分类完整数据源（从其他系统维护，按一级分类分组）
    const allLv2Categories = {
      '办公用品': ['A4 复印纸', '打印耗材', '书写工具', '文件夹', '订书机', '计算器', '印章'],
      '劳保防护': ['劳保手套', '安全帽', '防护眼镜', '防护服', '安全鞋', '耳塞', '口罩'],
      '数码设备': ['商务打印机', '多功能一体机', '扫描仪', '投影仪', '显示器', '键盘鼠标'],
      '清洁保养': ['消毒用品', '清洁工具', '拖把', '抹布', '清洁剂', '垃圾桶'],
      '办公家具': ['办公椅', '办公桌', '文件柜', '会议桌', '沙发', '茶几'],
      '行政耗材': ['信封', '标签纸', '胶带', '回形针', '图钉', '便签纸'],
      '电子设备': ['路由器', '交换机', '服务器', 'UPS电源', '监控设备'],
      '安全防护': ['消防器材', '应急灯', '安全标识', '防护栏', '监控摄像头'],
      '办公耗材': ['墨盒', '硒鼓', '色带', '打印纸', '复印纸', '标签纸'],
      '仓储物流': ['货架', '托盘', '打包机', '叉车', '手推车', '周转箱']
    };
    
    // 供应商对应的分站（mock 数据）
    const supplierStationMap = {
      supplier: '北京分站' // 供应商默认绑定北京分站
    };
    
    const stateTags = {
      enabled: '<span class="status-tag tag-enabled">启用</span>',
      disabled: '<span class="status-tag tag-disabled">禁用</span>'
    };
    
    let currentStation = 'main'; // 当前选中的分站（默认总站）
    
    const dataLv1 = [
      { id: 'C001', name: '办公用品', orderNo: 1, image: 'https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=200&q=60', status: 'enabled', updatedAt: '2026-01-12 10:30', owner: '王倩' },
      { id: 'C002', name: '劳保防护', orderNo: 2, image: 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?auto=format&fit=crop&w=200&q=60', status: 'enabled', updatedAt: '2026-01-11 15:18', owner: '赵敏' },
      { id: 'C003', name: '数码设备', orderNo: 3, image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=200&q=60', status: 'enabled', updatedAt: '2026-01-10 09:40', owner: '李旭' },
      { id: 'C004', name: '清洁保养', orderNo: 4, image: 'https://images.unsplash.com/photo-1581578731548-c64695cc6952?auto=format&fit=crop&w=200&q=60', status: 'disabled', updatedAt: '2026-01-09 16:22', owner: '张明' },
      { id: 'C005', name: '办公家具', orderNo: 5, image: 'https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?auto=format&fit=crop&w=200&q=60', status: 'enabled', updatedAt: '2026-01-08 14:10', owner: '陈楠' },
      { id: 'C006', name: '行政耗材', orderNo: 6, image: 'https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=200&q=60', status: 'disabled', updatedAt: '2026-01-07 11:05', owner: '刘琪' }
    ];
    
    const dataLv2 = [
      { id: 'SC001', parent: '办公用品', name: 'A4 复印纸', orderNo: 1, status: 'enabled', updatedAt: '2026-01-12 11:10' },
      { id: 'SC002', parent: '办公用品', name: '打印耗材', orderNo: 2, status: 'enabled', updatedAt: '2026-01-12 09:40' },
      { id: 'SC003', parent: '办公用品', name: '书写工具', orderNo: 3, status: 'disabled', updatedAt: '2026-01-11 16:20' },
      { id: 'SC004', parent: '劳保防护', name: '劳保手套', orderNo: 1, status: 'enabled', updatedAt: '2026-01-10 14:05' },
      { id: 'SC005', parent: '劳保防护', name: '安全帽', orderNo: 2, status: 'enabled', updatedAt: '2026-01-10 10:12' },
      { id: 'SC006', parent: '数码设备', name: '商务打印机', orderNo: 1, status: 'enabled', updatedAt: '2026-01-09 09:30' },
      { id: 'SC007', parent: '数码设备', name: '多功能一体机', orderNo: 2, status: 'disabled', updatedAt: '2026-01-08 18:45' },
      { id: 'SC008', parent: '清洁保养', name: '消毒用品', orderNo: 1, status: 'enabled', updatedAt: '2026-01-08 11:32' },
      { id: 'SC009', parent: '清洁保养', name: '清洁工具', orderNo: 2, status: 'enabled', updatedAt: '2026-01-07 15:56' },
      { id: 'SC010', parent: '办公家具', name: '办公椅', orderNo: 1, status: 'enabled', updatedAt: '2026-01-06 13:18' }
    ];
    
    const productCatalog = [
      { id: 'GP001', lv1: '办公用品', lv2: 'A4 复印纸', name: '晨光 A4 复印纸 500张/包', image: 'https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?auto=format&fit=crop&w=200&q=60', price: 89, recommend: 85, intro: '高白度不卡纸' },
      { id: 'GP002', lv1: '办公用品', lv2: '打印耗材', name: '惠普 680 墨盒', image: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=200&q=60', price: 126, recommend: 118, intro: '高兼容稳定打印' },
      { id: 'GP003', lv1: '劳保防护', lv2: '劳保手套', name: '防滑耐磨手套（12双）', image: 'https://images.unsplash.com/photo-1581578731548-c64695cc6952?auto=format&fit=crop&w=200&q=60', price: 72, recommend: 68, intro: '耐磨防滑' },
      { id: 'GP004', lv1: '数码设备', lv2: '商务打印机', name: '联想 A3 黑白打印机', image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=200&q=60', price: 2499, recommend: 2399, intro: '办公高效打印' },
      { id: 'GP005', lv1: '清洁保养', lv2: '消毒用品', name: '84 消毒液 5L', image: 'https://images.unsplash.com/photo-1584634731339-252c581abfc5?auto=format&fit=crop&w=200&q=60', price: 45, recommend: 42, intro: '家庭办公通用' },
      { id: 'GP006', lv1: '办公用品', lv2: '书写工具', name: '中性笔套装（24支）', image: 'https://images.unsplash.com/photo-1588072432836-9a06f2e3e559?auto=format&fit=crop&w=200&q=60', price: 56, recommend: 52, intro: '顺滑速干' },
      { id: 'GP007', lv1: '清洁保养', lv2: '清洁工具', name: '免洗拖把套装', image: 'https://images.unsplash.com/photo-1527515637462-cff94eecc1ac?auto=format&fit=crop&w=200&q=60', price: 119, recommend: 109, intro: '免手洗设计' },
      { id: 'GP008', lv1: '办公家具', lv2: '办公椅', name: '人体工学椅', image: 'https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?auto=format&fit=crop&w=200&q=60', price: 899, recommend: 829, intro: '久坐舒适' },
      { id: 'GP009', lv1: '劳保防护', lv2: '安全帽', name: 'ABS 安全帽（带反光条）', image: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=200&q=60', price: 48, recommend: 45, intro: '高强度耐冲击' },
      { id: 'GP010', lv1: '数码设备', lv2: '多功能一体机', name: '佳能 彩色一体机', image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=200&q=60', price: 3599, recommend: 3399, intro: '复印扫描一体' }
    ];
    
    const dataProducts = [
      { id: 'P001', productId: 'GP001', lv1: '办公用品', lv2: 'A4 复印纸', orderNo: 1, name: '晨光 A4 复印纸 500张/包', image: 'https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?auto=format&fit=crop&w=200&q=60', price: 89, recommend: 85, intro: '高白度不卡纸', status: 'enabled', updatedAt: '2026-01-12 10:20' },
      { id: 'P002', productId: 'GP002', lv1: '办公用品', lv2: '打印耗材', orderNo: 2, name: '惠普 680 墨盒', image: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=200&q=60', price: 126, recommend: 118, intro: '高兼容稳定打印', status: 'enabled', updatedAt: '2026-01-11 09:55' },
      { id: 'P003', productId: 'GP003', lv1: '劳保防护', lv2: '劳保手套', orderNo: 1, name: '防滑耐磨手套（12双）', image: 'https://images.unsplash.com/photo-1581578731548-c64695cc6952?auto=format&fit=crop&w=200&q=60', price: 72, recommend: 68, intro: '耐磨防滑', status: 'enabled', updatedAt: '2026-01-11 16:38' },
      { id: 'P004', productId: 'GP004', lv1: '数码设备', lv2: '商务打印机', orderNo: 1, name: '联想 A3 黑白打印机', image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=200&q=60', price: 2499, recommend: 2399, intro: '办公高效打印', status: 'disabled', updatedAt: '2026-01-10 14:42' },
      { id: 'P005', productId: 'GP005', lv1: '清洁保养', lv2: '消毒用品', orderNo: 1, name: '84 消毒液 5L', image: 'https://images.unsplash.com/photo-1584634731339-252c581abfc5?auto=format&fit=crop&w=200&q=60', price: 45, recommend: 42, intro: '家庭办公通用', status: 'enabled', updatedAt: '2026-01-10 09:17' }
    ];
    
    let currentTab = 'lv1';
    let selectedIds = new Set();
    let drawerMode = 'create';
    let editingId = null;
    let currentRole = 'admin'; // 当前角色
    
    function setRoleTag() {
      const role = localStorage.getItem('role') || 'admin';
      currentRole = role;
      const roleName = roleNameMap[role] || '平台管理员';
      
      // 更新角色选择器
      const roleSelector = document.getElementById('roleSelector');
      if (roleSelector) {
        roleSelector.value = role;
      }
      
      // 更新角色标签
      document.getElementById('roleTag').textContent = roleName;
      
      // 更新角色提示文本
      const roleHint = document.getElementById('roleHint');
      if (role === 'supplier') {
        roleHint.textContent = '供应商可查看所属分站推荐内容';
        // 供应商角色标签样式调整
        document.getElementById('roleTag').className = 'px-3 py-1 text-xs rounded-full bg-blue-50 text-blue-600 border border-blue-100';
      } else if (role === 'admin') {
        roleHint.textContent = '仅管理员可配置推荐';
        document.getElementById('roleTag').className = 'px-3 py-1 text-xs rounded-full bg-red-50 text-red-600 border border-red-100';
      } else {
        roleHint.textContent = '无权限访问';
      }
      
      // 设置分站显示
      setupStationDisplay(role);
      
      // 显示/隐藏复用推荐按钮（仅平台管理员可见）
      const reuseBtn = document.getElementById('reuseRecommendBtn');
      if (reuseBtn) {
        if (role === 'admin' || role === 'super-admin') {
          reuseBtn.classList.remove('hidden');
        } else {
          reuseBtn.classList.add('hidden');
        }
      }
    }
    
    // 切换角色
    function switchRole() {
      const newRole = document.getElementById('roleSelector').value;
      currentRole = newRole;
      localStorage.setItem('role', newRole);
      setRoleTag();
      
      // 提示用户角色已切换
      const roleName = roleNameMap[newRole] || '平台管理员';
      console.log(`已切换到角色：${roleName}`);
    }
    
    // 更新抽屉中的分站显示
    function updateDrawerStation() {
      const drawerStation = document.getElementById('drawerStation');
      let stationName = '';
      
      if (currentRole === 'supplier') {
        // 供应商：显示对应的分站
        stationName = supplierStationMap[currentRole] || '未分配分站';
      } else if (currentRole === 'admin' || currentRole === 'super-admin') {
        // 管理员：获取当前选择的分站
        const stationSelect = document.getElementById('stationSelect');
        if (stationSelect && !stationSelect.classList.contains('hidden')) {
          const selectedStationId = stationSelect.value || currentStation;
          const selectedStation = stationList.find(s => s.id === selectedStationId);
          stationName = selectedStation ? selectedStation.name : '总站';
        } else {
          // 如果下拉框隐藏，使用 currentStation
          const selectedStation = stationList.find(s => s.id === currentStation);
          stationName = selectedStation ? selectedStation.name : '总站';
        }
      }
      
      // 显示分站名称（红色文字）
      if (stationName) {
        drawerStation.textContent = stationName;
        drawerStation.style.display = 'inline';
      } else {
        drawerStation.textContent = '';
        drawerStation.style.display = 'none';
      }
    }
    
    function setupStationDisplay(role) {
      const stationText = document.getElementById('stationText');
      const stationSelect = document.getElementById('stationSelect');
      const stationDisplayArea = document.getElementById('stationDisplayArea');
      
      // 确保分站显示区域可见
      stationDisplayArea.classList.remove('hidden');
      
      if (role === 'supplier') {
        // 供应商：显示只读文本（暗红色底，白色字）
        stationText.classList.remove('hidden');
        stationSelect.classList.add('hidden');
        const stationName = supplierStationMap[role] || '未分配分站';
        stationText.textContent = stationName;
        stationText.className = 'station-text-supplier'; // 应用暗红色样式
        currentStation = stationList.find(s => s.name === stationName)?.id || 'main';
      } else if (role === 'admin' || role === 'super-admin') {
        // 平台管理员/超级管理员：显示下拉框
        stationText.classList.add('hidden');
        stationSelect.classList.remove('hidden');
        // 初始化下拉框选项
        stationSelect.innerHTML = stationList.map(s => 
          `<option value="${s.id}" ${s.id === currentStation ? 'selected' : ''}>${s.name}</option>`
        ).join('');
        stationSelect.value = currentStation || 'main';
      } else {
        // 其他角色：隐藏分站显示
        stationDisplayArea.classList.add('hidden');
      }
    }
    
    function handleStationChange() {
      const selectedStationId = document.getElementById('stationSelect').value;
      currentStation = selectedStationId;
      const selectedStation = stationList.find(s => s.id === selectedStationId);
      console.log('切换分站：', selectedStation?.name || '总站');
      
      // 如果抽屉已打开，更新抽屉中的分站显示
      const drawerPanel = document.getElementById('drawerPanel');
      if (drawerPanel && drawerPanel.classList.contains('active')) {
        updateDrawerStation();
      }
      
      // 这里可以添加重新加载数据的逻辑
      // 例如：filterDataByStation(currentStation);
    }
    
    function switchTab(tab) {
      currentTab = tab;
      selectedIds.clear();
      updateSelectedCount();
      
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === tab);
        btn.classList.toggle('text-gray-600', btn.dataset.tab !== tab);
      });
      
      renderFilterBar();
      renderTable();
    }
    
    function renderFilterBar() {
      const container = document.getElementById('filterBar');
      let html = '';
      
      if (currentTab === 'lv1') {
        html = `
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">状态</label>
            <select class="px-3 py-2 border rounded text-sm filter-select">
              <option>全部</option>
              <option>启用</option>
              <option>禁用</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">关键词</label>
            <input class="px-3 py-2 border rounded text-sm filter-input" placeholder="分类名称">
          </div>
          <button class="px-3 py-2 text-sm bg-gray-100 rounded hover:bg-gray-200">查询</button>
          <button class="px-3 py-2 text-sm border rounded">重置</button>
        `;
      } else if (currentTab === 'lv2') {
        html = `
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">一级分类</label>
            <select class="px-3 py-2 border rounded text-sm filter-select">
              <option>全部</option>
              <option>办公用品</option>
              <option>劳保防护</option>
              <option>数码设备</option>
              <option>清洁保养</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">状态</label>
            <select class="px-3 py-2 border rounded text-sm filter-select">
              <option>全部</option>
              <option>启用</option>
              <option>禁用</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">关键词</label>
            <input class="px-3 py-2 border rounded text-sm filter-input" placeholder="二级分类名称">
          </div>
          <button class="px-3 py-2 text-sm bg-gray-100 rounded hover:bg-gray-200">查询</button>
          <button class="px-3 py-2 text-sm border rounded">重置</button>
        `;
      } else {
        html = `
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">一级分类</label>
            <select class="px-3 py-2 border rounded text-sm filter-select">
              <option>全部</option>
              <option>办公用品</option>
              <option>劳保防护</option>
              <option>数码设备</option>
              <option>清洁保养</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">二级分类</label>
            <select class="px-3 py-2 border rounded text-sm filter-select">
              <option>全部</option>
              <option>A4 复印纸</option>
              <option>打印耗材</option>
              <option>劳保手套</option>
              <option>消毒用品</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">状态</label>
            <select class="px-3 py-2 border rounded text-sm filter-select">
              <option>全部</option>
              <option>启用</option>
              <option>禁用</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">排序</label>
            <select class="px-3 py-2 border rounded text-sm filter-select">
              <option>默认</option>
              <option>价格升序</option>
              <option>价格降序</option>
              <option>更新时间</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">关键词</label>
            <input class="px-3 py-2 border rounded text-sm filter-input" placeholder="产品名称">
          </div>
          <button class="px-3 py-2 text-sm bg-gray-100 rounded hover:bg-gray-200">查询</button>
          <button class="px-3 py-2 text-sm border rounded">重置</button>
        `;
      }
      container.innerHTML = html;
    }
    
    function renderTable() {
      const head = document.getElementById('tableHead');
      const body = document.getElementById('tableBody');
      let headHtml = '';
      let rowsHtml = '';
      
      if (currentTab === 'lv1') {
        headHtml = `
          <th class="px-4 py-3"><input type="checkbox" onclick="toggleAll(this)"></th>
          <th class="px-4 py-3 text-left">一级分类</th>
          <th class="px-4 py-3 text-left">推荐位序号</th>
          <th class="px-4 py-3 text-left">示意图</th>
          <th class="px-4 py-3 text-left">状态</th>
          <th class="px-4 py-3 text-left">更新时间</th>
          <th class="px-4 py-3 text-left">创建人</th>
          <th class="px-4 py-3 text-right">操作</th>
        `;
        rowsHtml = dataLv1.map(item => `
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3"><input type="checkbox" data-id="${item.id}" onclick="toggleSelect('${item.id}', this)"></td>
            <td class="px-4 py-3">
              <div class="font-medium text-gray-900">${item.name}</div>
              <div class="text-xs text-gray-400">${item.id}</div>
            </td>
            <td class="px-4 py-3 text-gray-500">#${item.orderNo}</td>
            <td class="px-4 py-3">
              <img src="${item.image}" class="w-14 h-10 rounded object-cover" alt="">
            </td>
            <td class="px-4 py-3">${stateTags[item.status]}</td>
            <td class="px-4 py-3 text-gray-500">${item.updatedAt}</td>
            <td class="px-4 py-3 text-gray-500">${item.owner}</td>
            <td class="px-4 py-3 text-right">
              <button class="text-blue-600 hover:underline mr-2" onclick='openDrawer("edit", ${JSON.stringify(item)})'>编辑</button>
              <button class="${item.status === 'enabled' ? 'text-yellow-600' : 'text-green-600'} hover:underline mr-2" onclick="toggleStatus('${item.id}')">
                ${item.status === 'enabled' ? '禁用' : '启用'}
              </button>
              <button class="text-red-600 hover:underline" onclick="deleteItem('${item.id}')">删除</button>
            </td>
          </tr>
        `).join('');
      } else if (currentTab === 'lv2') {
        headHtml = `
          <th class="px-4 py-3"><input type="checkbox" onclick="toggleAll(this)"></th>
          <th class="px-4 py-3 text-left">二级分类</th>
          <th class="px-4 py-3 text-left">所属一级分类</th>
          <th class="px-4 py-3 text-left">推荐位序号</th>
          <th class="px-4 py-3 text-left">状态</th>
          <th class="px-4 py-3 text-left">更新时间</th>
          <th class="px-4 py-3 text-right">操作</th>
        `;
        rowsHtml = dataLv2.map(item => `
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3"><input type="checkbox" data-id="${item.id}" onclick="toggleSelect('${item.id}', this)"></td>
            <td class="px-4 py-3">
              <div class="font-medium text-gray-900">${item.name}</div>
              <div class="text-xs text-gray-400">${item.id}</div>
            </td>
            <td class="px-4 py-3 text-gray-500">${item.parent}</td>
            <td class="px-4 py-3 text-gray-500">#${item.orderNo}</td>
            <td class="px-4 py-3">${stateTags[item.status]}</td>
            <td class="px-4 py-3 text-gray-500">${item.updatedAt}</td>
            <td class="px-4 py-3 text-right">
              <button class="text-blue-600 hover:underline mr-2" onclick='openDrawer("edit", ${JSON.stringify(item)})'>编辑</button>
              <button class="${item.status === 'enabled' ? 'text-yellow-600' : 'text-green-600'} hover:underline mr-2" onclick="toggleStatus('${item.id}')">
                ${item.status === 'enabled' ? '禁用' : '启用'}
              </button>
              <button class="text-red-600 hover:underline" onclick="deleteItem('${item.id}')">删除</button>
            </td>
          </tr>
        `).join('');
      } else {
        headHtml = `
          <th class="px-4 py-3"><input type="checkbox" onclick="toggleAll(this)"></th>
          <th class="px-4 py-3 text-left">推荐产品</th>
          <th class="px-4 py-3 text-left">分类归属</th>
          <th class="px-4 py-3 text-left">推荐位序号</th>
          <th class="px-4 py-3 text-left">价格 / 推荐值</th>
          <th class="px-4 py-3 text-left">状态</th>
          <th class="px-4 py-3 text-left">更新时间</th>
          <th class="px-4 py-3 text-right">操作</th>
        `;
        rowsHtml = dataProducts.map(item => `
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3"><input type="checkbox" data-id="${item.id}" onclick="toggleSelect('${item.id}', this)"></td>
            <td class="px-4 py-3">
              <div class="font-medium text-gray-900">${item.name}</div>
              <div class="text-xs text-gray-400">${item.id} · ${item.intro}</div>
            </td>
            <td class="px-4 py-3 text-gray-500">${item.lv1} / ${item.lv2}</td>
            <td class="px-4 py-3 text-gray-500">#${item.orderNo}</td>
            <td class="px-4 py-3 text-gray-500">¥${item.price} / ¥${item.recommend}</td>
            <td class="px-4 py-3">${stateTags[item.status]}</td>
            <td class="px-4 py-3 text-gray-500">${item.updatedAt}</td>
            <td class="px-4 py-3 text-right">
              <button class="text-blue-600 hover:underline mr-2" onclick='openDrawer("edit", ${JSON.stringify(item)})'>编辑</button>
              <button class="${item.status === 'enabled' ? 'text-yellow-600' : 'text-green-600'} hover:underline mr-2" onclick="toggleStatus('${item.id}')">
                ${item.status === 'enabled' ? '禁用' : '启用'}
              </button>
              <button class="text-red-600 hover:underline" onclick="deleteItem('${item.id}')">删除</button>
            </td>
          </tr>
        `).join('');
      }
      
      head.innerHTML = headHtml;
      body.innerHTML = rowsHtml;
      updateCounts();
    }
    
    function toggleSelect(id, checkbox) {
      if (checkbox.checked) {
        selectedIds.add(id);
      } else {
        selectedIds.delete(id);
      }
      updateSelectedCount();
    }
    
    function toggleAll(source) {
      document.querySelectorAll('#tableBody input[type="checkbox"]').forEach(cb => {
        cb.checked = source.checked;
        if (source.checked) {
          selectedIds.add(cb.dataset.id);
        } else {
          selectedIds.delete(cb.dataset.id);
        }
      });
      updateSelectedCount();
    }
    
    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = selectedIds.size;
    }
    
    function batchAction(action) {
      if (selectedIds.size === 0) {
        alert('请先选择要操作的记录');
        return;
      }
      if (action === 'delete') {
        if (!confirm('确认批量删除所选记录？')) {
          return;
        }
      }
      applyBatchAction(action);
    }
    
    function openDrawer(mode, data = null) {
      drawerMode = mode;
      editingId = data ? data.id : null;
      document.getElementById('drawerOverlay').classList.add('active');
      document.getElementById('drawerPanel').classList.add('active');
      document.getElementById('drawerTitle').textContent = mode === 'create' ? '新建配置' : '编辑配置';
      document.getElementById('drawerSubtitle').textContent = currentTab === 'lv1' ? '一级推荐分类配置' : (currentTab === 'lv2' ? '二级推荐分类配置' : '推荐产品配置');
      
      // 更新当前分站显示
      updateDrawerStation();
      
      document.getElementById('formLv1').classList.toggle('hidden', currentTab !== 'lv1');
      document.getElementById('formLv2').classList.toggle('hidden', currentTab !== 'lv2');
      document.getElementById('formProduct').classList.toggle('hidden', currentTab !== 'product');
      
      if (mode === 'edit' && data) {
        if (currentTab === 'lv1') {
          // 先构建选项，再设置值
          buildLv1NameOptions(editingId);
          document.getElementById('lv1Name').value = data.name || '';
          document.getElementById('lv1OrderNo').value = data.orderNo || '';
          document.getElementById('lv1Image').value = data.image || '';
          document.getElementById('lv1Status').value = data.status || 'enabled';
        } else if (currentTab === 'lv2') {
          // 先设置一级分类，再构建二级分类选项，最后设置二级分类值
          document.getElementById('lv2Parent').value = data.parent || '办公用品';
          buildLv2NameOptions(data.parent || '办公用品', editingId);
          document.getElementById('lv2Name').value = data.name || '';
          document.getElementById('lv2OrderNo').value = data.orderNo || '';
          document.getElementById('lv2Status').value = data.status || 'enabled';
        } else {
          document.getElementById('productLv1').value = data.lv1 || '办公用品';
          document.getElementById('productLv2').value = data.lv2 || 'A4 复印纸';
          document.getElementById('productOrderNo').value = data.orderNo || '';
          document.getElementById('productSearch').value = '';
          buildProductOptions();
          document.getElementById('productSelect').value = data.productId || '';
          fillProductFields(data);
          document.getElementById('productStatus').value = data.status || 'enabled';
        }
      } else {
        // 新建模式：清空所有字段并构建下拉框选项
        document.querySelectorAll('#drawerPanel input, #drawerPanel textarea').forEach(el => {
          if (el.type !== 'select-one') {
            el.value = '';
          }
        });
        document.getElementById('productSelect').value = '';
        document.getElementById('productImagePreview').innerHTML = '图片预览';
        // 构建下拉框选项
        if (currentTab === 'lv1') {
          buildLv1NameOptions(null);
        } else if (currentTab === 'lv2') {
          const parent = document.getElementById('lv2Parent').value || '办公用品';
          buildLv2NameOptions(parent, null);
        }
      }
    }
    
    // 构建一级分类名称下拉框
    function buildLv1NameOptions(editingId) {
      const select = document.getElementById('lv1Name');
      const existingNames = dataLv1.map(item => item.name);
      
      select.innerHTML = '<option value="">请选择一级分类</option>';
      
      // 先添加可选择的项（不在列表中的，或者正在编辑的）
      allLv1Categories.forEach(category => {
        const isExisting = existingNames.includes(category);
        const isEditing = editingId && dataLv1.find(item => item.id === editingId && item.name === category);
        
        // 如果不存在，或者是正在编辑的项，则添加到可选择列表
        if (!isExisting || isEditing) {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = category;
          select.appendChild(option);
        }
      });
      
      // 再添加已存在的项（置灰并标注），放在底部
      allLv1Categories.forEach(category => {
        const isExisting = existingNames.includes(category);
        const isEditing = editingId && dataLv1.find(item => item.id === editingId && item.name === category);
        
        // 如果已存在且不是正在编辑的项，则置灰并标注，放在底部
        if (isExisting && !isEditing) {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = `${category}（已在列表中）`;
          option.disabled = true;
          option.style.color = '#9ca3af';
          select.appendChild(option);
        }
      });
    }
    
    // 构建二级分类名称下拉框
    function buildLv2NameOptions(parent, editingId) {
      const select = document.getElementById('lv2Name');
      const existingNames = dataLv2
        .filter(item => item.parent === parent)
        .map(item => item.name);
      
      const categories = allLv2Categories[parent] || [];
      
      select.innerHTML = '<option value="">请选择二级分类</option>';
      
      // 先添加可选择的项（不在列表中的，或者正在编辑的）
      categories.forEach(category => {
        const isExisting = existingNames.includes(category);
        const isEditing = editingId && dataLv2.find(item => item.id === editingId && item.name === category && item.parent === parent);
        
        // 如果不存在，或者是正在编辑的项，则添加到可选择列表
        if (!isExisting || isEditing) {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = category;
          select.appendChild(option);
        }
      });
      
      // 再添加已存在的项（置灰并标注），放在底部
      categories.forEach(category => {
        const isExisting = existingNames.includes(category);
        const isEditing = editingId && dataLv2.find(item => item.id === editingId && item.name === category && item.parent === parent);
        
        // 如果已存在且不是正在编辑的项，则置灰并标注，放在底部
        if (isExisting && !isEditing) {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = `${category}（已在列表中）`;
          option.disabled = true;
          option.style.color = '#9ca3af';
          select.appendChild(option);
        }
      });
    }
    
    // 一级分类名称改变时的处理
    function handleLv1NameChange() {
      // 可以在这里添加其他逻辑，比如根据选择的一级分类加载相关数据
    }
    
    // 二级分类名称改变时的处理
    function handleLv2NameChange() {
      // 可以在这里添加其他逻辑
    }
    
    // 二级分类的一级分类改变时的处理
    function handleLv2ParentChange() {
      const parent = document.getElementById('lv2Parent').value;
      buildLv2NameOptions(parent, editingId);
      // 清空二级分类选择
      document.getElementById('lv2Name').value = '';
    }
    
    function closeDrawer() {
      document.getElementById('drawerOverlay').classList.remove('active');
      document.getElementById('drawerPanel').classList.remove('active');
    }
    
    function saveDrawer() {
      if (currentTab === 'lv1') {
        const payload = {
          id: editingId || `C${String(Date.now()).slice(-4)}`,
          name: document.getElementById('lv1Name').value.trim(),
          orderNo: Number(document.getElementById('lv1OrderNo').value || 0),
          image: document.getElementById('lv1Image').value.trim(),
          status: document.getElementById('lv1Status').value,
          updatedAt: getNow(),
          owner: '管理员'
        };
        upsertItem(dataLv1, payload);
      } else if (currentTab === 'lv2') {
        const payload = {
          id: editingId || `SC${String(Date.now()).slice(-4)}`,
          parent: document.getElementById('lv2Parent').value,
          name: document.getElementById('lv2Name').value.trim(),
          orderNo: Number(document.getElementById('lv2OrderNo').value || 0),
          status: document.getElementById('lv2Status').value,
          updatedAt: getNow()
        };
        upsertItem(dataLv2, payload);
      } else {
        const productId = document.getElementById('productSelect').value;
        const selected = productCatalog.find(item => item.id === productId);
        if (!selected) {
          alert('请先选择推荐产品');
          return;
        }
        const payload = {
          id: editingId || `P${String(Date.now()).slice(-4)}`,
          productId: selected.id,
          lv1: document.getElementById('productLv1').value,
          lv2: document.getElementById('productLv2').value,
          orderNo: Number(document.getElementById('productOrderNo').value || 0),
          name: selected.name,
          image: selected.image,
          price: selected.price,
          recommend: selected.recommend,
          intro: selected.intro,
          status: document.getElementById('productStatus').value,
          updatedAt: getNow()
        };
        upsertItem(dataProducts, payload);
      }
      renderTable();
      selectedIds.clear();
      updateSelectedCount();
      alert('保存成功（演示已生效）');
      closeDrawer();
    }
    
    function updateCounts() {
      document.getElementById('countLv1').textContent = dataLv1.length;
      document.getElementById('countLv2').textContent = dataLv2.length;
      document.getElementById('countProduct').textContent = dataProducts.length;
      const total = currentTab === 'lv1' ? dataLv1.length : (currentTab === 'lv2' ? dataLv2.length : dataProducts.length);
      document.getElementById('totalCount').textContent = total;
    }
    
    function getNow() {
      const now = new Date();
      const pad = (val) => String(val).padStart(2, '0');
      return `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
    }
    
    function getCurrentDataList() {
      if (currentTab === 'lv1') return dataLv1;
      if (currentTab === 'lv2') return dataLv2;
      return dataProducts;
    }
    
    function upsertItem(list, item) {
      const index = list.findIndex(existing => existing.id === item.id);
      if (index >= 0) {
        list[index] = { ...list[index], ...item };
      } else {
        list.unshift(item);
      }
    }
    
    function toggleStatus(id) {
      const list = getCurrentDataList();
      const target = list.find(item => item.id === id);
      if (!target) return;
      target.status = target.status === 'enabled' ? 'disabled' : 'enabled';
      target.updatedAt = getNow();
      renderTable();
    }
    
    function deleteItem(id) {
      if (!confirm('确认删除该记录？')) return;
      const list = getCurrentDataList();
      const index = list.findIndex(item => item.id === id);
      if (index >= 0) {
        list.splice(index, 1);
        selectedIds.delete(id);
        updateSelectedCount();
        renderTable();
      }
    }
    
    function applyBatchAction(action) {
      const list = getCurrentDataList();
      const idSet = new Set(selectedIds);
      if (action === 'delete') {
        for (let i = list.length - 1; i >= 0; i -= 1) {
          if (idSet.has(list[i].id)) {
            list.splice(i, 1);
          }
        }
      } else {
        const nextStatus = action === 'enable' ? 'enabled' : 'disabled';
        list.forEach(item => {
          if (idSet.has(item.id)) {
            item.status = nextStatus;
            item.updatedAt = getNow();
          }
        });
      }
      selectedIds.clear();
      updateSelectedCount();
      renderTable();
    }
    
    function buildProductOptions(keyword = '') {
      const lv1 = document.getElementById('productLv1').value;
      const lv2 = document.getElementById('productLv2').value;
      const select = document.getElementById('productSelect');
      const lowerKeyword = keyword.trim().toLowerCase();
      const options = productCatalog.filter(item => {
        const matchCategory = item.lv1 === lv1 && item.lv2 === lv2;
        const matchKeyword = !lowerKeyword || item.name.toLowerCase().includes(lowerKeyword);
        return matchCategory && matchKeyword;
      });
      
      select.innerHTML = '<option value="">请选择产品</option>' + options.map(item => (
        `<option value="${item.id}">${item.name}</option>`
      )).join('');
    }
    
    function fillProductFields(selected) {
      document.getElementById('productImage').value = selected.image || '';
      document.getElementById('productPrice').value = selected.price || '';
      document.getElementById('productRecommendPrice').value = selected.recommend || '';
      document.getElementById('productIntro').value = selected.intro || '';
      document.getElementById('productImagePreview').innerHTML = selected.image
        ? `<img src="${selected.image}" alt="" class="h-24 w-full object-cover rounded">`
        : '图片预览';
    }
    
    function handleProductSelect() {
      const productId = document.getElementById('productSelect').value;
      const selected = productCatalog.find(item => item.id === productId);
      if (!selected) {
        fillProductFields({ image: '', price: '', recommend: '', intro: '' });
        return;
      }
      fillProductFields(selected);
    }
    
    function initProductSelectors() {
      const lv1 = document.getElementById('productLv1');
      const lv2 = document.getElementById('productLv2');
      const search = document.getElementById('productSearch');
      
      const rebuild = () => {
        buildProductOptions(search.value);
        handleProductSelect();
      };
      
      lv1.addEventListener('change', rebuild);
      lv2.addEventListener('change', rebuild);
      search.addEventListener('input', () => buildProductOptions(search.value));
      
      buildProductOptions();
    }
    
    // 打开复用推荐弹窗
    function openReuseModal() {
      // 只允许平台管理员使用
      if (currentRole !== 'admin' && currentRole !== 'super-admin') {
        alert('仅平台管理员可使用复用推荐功能');
        return;
      }
      
      selectedReuseStation = null;
      document.getElementById('reuseModalOverlay').classList.add('active');
      document.getElementById('reuseModal').classList.add('active');
      renderReuseStationList();
      updateConfirmButton();
    }
    
    // 关闭复用推荐弹窗
    function closeReuseModal() {
      document.getElementById('reuseModalOverlay').classList.remove('active');
      document.getElementById('reuseModal').classList.remove('active');
      selectedReuseStation = null;
      updateConfirmButton();
    }
    
    // 渲染复用推荐分站列表
    function renderReuseStationList() {
      const container = document.getElementById('reuseStationList');
      const currentStationId = currentStation;
      
      let html = '';
      
      stationList.forEach(station => {
        // 排除当前分站
        if (station.id === currentStationId) {
          return;
        }
        
        const stats = stationStats[station.id] || { lv1: 0, lv2: 0, product: 0 };
        const isSelected = selectedReuseStation === station.id;
        
        html += `
          <div class="station-card ${isSelected ? 'selected' : ''}" onclick="selectReuseStation('${station.id}')">
            <div class="station-card-content">
              <div class="station-card-header">
                <div class="flex items-center gap-2">
                  <i class="fas fa-building text-gray-400 text-sm"></i>
                  <div class="station-card-title">${station.name}</div>
                </div>
              </div>
              <div class="station-card-stats">
                <div class="station-card-stat">
                  <i class="fas fa-layer-group text-gray-400 text-xs"></i>
                  <span class="station-card-stat-label">一级推荐分类</span>
                  <span class="station-card-stat-value">${stats.lv1}</span>
                </div>
                <div class="station-card-stat">
                  <i class="fas fa-sitemap text-gray-400 text-xs"></i>
                  <span class="station-card-stat-label">二级推荐分类</span>
                  <span class="station-card-stat-value">${stats.lv2}</span>
                </div>
                <div class="station-card-stat">
                  <i class="fas fa-box text-gray-400 text-xs"></i>
                  <span class="station-card-stat-label">推荐产品</span>
                  <span class="station-card-stat-value">${stats.product}</span>
                </div>
              </div>
            </div>
            <div class="station-card-checkbox">
              ${isSelected ? '<i class="fas fa-check-circle text-primary"></i>' : '<i class="far fa-circle text-gray-300"></i>'}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html || '<div class="text-center text-gray-500 py-12"><i class="fas fa-inbox text-4xl mb-3 opacity-30"></i><p>暂无其他分站可复用</p></div>';
    }
    
    // 选择复用分站
    function selectReuseStation(stationId) {
      selectedReuseStation = selectedReuseStation === stationId ? null : stationId;
      renderReuseStationList();
      updateConfirmButton();
    }
    
    // 更新确认复用按钮状态
    function updateConfirmButton() {
      const btn = document.getElementById('confirmReuseBtn');
      if (selectedReuseStation) {
        btn.disabled = false;
      } else {
        btn.disabled = true;
      }
    }
    
    // 确认复用
    function confirmReuse() {
      if (!selectedReuseStation) {
        alert('请先选择要复用的分站');
        return;
      }
      
      const selectedStation = stationList.find(s => s.id === selectedReuseStation);
      const stats = stationStats[selectedReuseStation] || { lv1: 0, lv2: 0, product: 0 };
      
      if (!confirm(`确认复用"${selectedStation.name}"的推荐配置？\n\n将复用：\n- 一级推荐分类：${stats.lv1} 个\n- 二级推荐分类：${stats.lv2} 个\n- 推荐产品：${stats.product} 个\n\n注意：复用后仍将保留本站原有推荐配置。`)) {
        return;
      }
      
      // 执行复用逻辑（演示）
      alert(`已成功复用"${selectedStation.name}"的推荐配置\n\n（演示操作，实际环境会从该分站复制推荐配置到当前分站）`);
      
      // 关闭弹窗
      closeReuseModal();
      
      // 可以在这里添加实际的数据复制逻辑
      // 例如：copyStationRecommendations(selectedReuseStation, currentStation);
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      // 初始化角色（从 localStorage 读取或默认 admin）
      const savedRole = localStorage.getItem('role');
      if (savedRole && (savedRole === 'admin' || savedRole === 'supplier')) {
        currentRole = savedRole;
      } else {
        currentRole = 'admin';
        localStorage.setItem('role', 'admin');
      }
      
      setRoleTag();
      renderFilterBar();
      renderTable();
      initProductSelectors();
      
      // 初始化侧边栏状态
      const savedState = localStorage.getItem('adminSidebarCollapsed');
      if (savedState === 'true') {
        const sidebar = document.getElementById('adminSidebar');
        const icon = document.getElementById('sidebarToggleIcon');
        sidebar.classList.add('collapsed');
        icon.classList.remove('fa-chevron-left');
        icon.classList.add('fa-chevron-right');
      }
    });
    
    // ========== 切换侧边栏收起/展开 ==========
    function toggleAdminSidebar() {
      const sidebar = document.getElementById('adminSidebar');
      const icon = document.getElementById('sidebarToggleIcon');
      sidebar.classList.toggle('collapsed');
      
      if (sidebar.classList.contains('collapsed')) {
        icon.classList.remove('fa-chevron-left');
        icon.classList.add('fa-chevron-right');
      } else {
        icon.classList.remove('fa-chevron-right');
        icon.classList.add('fa-chevron-left');
      }
      
      // 保存状态到 localStorage
      localStorage.setItem('adminSidebarCollapsed', sidebar.classList.contains('collapsed'));
    }
    
    // ========== 处理菜单点击 ==========
    function handleMenuClick(element, page) {
      event.preventDefault();
      
      // 更新活动状态
      document.querySelectorAll('.admin-menu-item').forEach(item => {
        item.classList.remove('active');
      });
      element.classList.add('active');
      
      // 已实现的页面直接跳转
      if (page === 'admin_dashboard.html' || page === 'admin_reco_manage.html') {
        window.location.href = page;
      } else {
        // 未实现的页面显示提示
        alert(`页面 "${page}" 尚未开发，敬请期待！`);
      }
    }
  </script>
</body>
</html>
